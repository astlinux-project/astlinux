From 4b16b3732a97684bed40cdffde3038129169dd7e Mon Sep 17 00:00:00 2001
From: Colin Watson <cjwatson@debian.org>
Date: Fri, 14 Feb 2025 00:13:11 +0000
Subject: CVE-2025-26465: Fix MitM in verify_host_key_callback

Incorrect checking of the return value from verify_host_key resulted in
a potential machine-in-the-middle attack in the event of an
out-of-memory error when VerifyHostKeyDNS is enabled.

Reported by Qualys.  Patch from the OpenSSH team.

Last-Update: 2025-02-14

Patch-Name: CVE-2025-26465.patch
---
 sshconnect2.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/sshconnect2.c b/sshconnect2.c
index 61392c934..ef42510d7 100644
--- a/sshconnect2.c
+++ b/sshconnect2.c
@@ -97,7 +97,7 @@ struct sockaddr *xxx_hostaddr;
 static int
 verify_host_key_callback(struct sshkey *hostkey, struct ssh *ssh)
 {
-	if (verify_host_key(xxx_host, xxx_hostaddr, hostkey) == -1)
+	if (verify_host_key(xxx_host, xxx_hostaddr, hostkey) != 0)
 		fatal("Host key verification failed.");
 	return 0;
 }
